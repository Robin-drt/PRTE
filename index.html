<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pr√©sence en ligne</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h1 { margin-bottom: 10px; }
    .card { border: 1px solid #ccc; border-radius: 10px; padding: 20px; max-width: 400px; margin-bottom: 20px; }
    input, button { width: 100%; padding: 10px; margin-top: 10px; }
    ul { padding-left: 20px; }
  </style>

  <!-- Firebase SDK (compat pour HTML simple) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- jsPDF pour PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>Pointage de pr√©sence</h1>

<div class="card">
  <h2>√âl√®ve</h2>
  <input id="studentName" placeholder="Votre nom" />
  <button onclick="markPresence()">Je suis pr√©sent</button>
  <p id="status"></p>
</div>

<div class="card">
  <h2>Professeur</h2>
  <button onclick="downloadPDF()">T√©l√©charger la liste PDF</button>
  <ul id="presentList"></ul>
</div>

<script>
  // üî¥ Configuration Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyByUZMiGpnXGgIG0Asqso2Nk77ypBgsNSQ",
    authDomain: "prte-245ba.firebaseapp.com",
    databaseURL: "https://prte-245ba-default-rtdb.firebaseio.com",
    projectId: "prte-245ba",
    storageBucket: "prte-245ba.appspot.com",
    messagingSenderId: "670788895694",
    appId: "1:670788895694:web:17bd1e2b87f0caf083e19f"
  };

  // Initialisation Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
  const presenceRef = database.ref("presence");

  function markPresence() {
    const name = document.getElementById("studentName").value.trim();
    const status = document.getElementById("status");

    if (!name) {
      status.textContent = "Veuillez entrer votre nom";
      status.style.color = "red";
      return;
    }

    if (localStorage.getItem("alreadyMarked")) {
      status.textContent = "Pr√©sence d√©j√† enregistr√©e sur cet appareil";
      status.style.color = "red";
      return;
    }

    const entry = {
      name,
      time: new Date().toLocaleTimeString(),
      date: new Date().toLocaleDateString()
    };

    presenceRef.push(entry);
    localStorage.setItem("alreadyMarked", "true");

    status.textContent = `Pr√©sence enregistr√©e : ${name}`;
    status.style.color = "green";
  }

  // Synchronisation temps r√©el pour le professeur
  presenceRef.on("value", snapshot => {
    const list = document.getElementById("presentList");
    list.innerHTML = "";
    const data = snapshot.val();
    let i = 1;
    for (let key in data) {
      const li = document.createElement("li");
      li.textContent = `${i}. ${data[key].name} ‚Äî ${data[key].time}`;
      list.appendChild(li);
      i++;
    }
  });

  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y = 20;

    doc.setFontSize(16);
    doc.text("Liste des pr√©sents", 10, 10);

    const items = document.querySelectorAll("#presentList li");
    items.forEach((item, index) => {
      doc.setFontSize(12);
      doc.text(`${index + 1}. ${item.textContent}`, 10, y);
      y += 8;
    });

    doc.save("presence.pdf");
  }
</script>

</body>
</html>
